#!/bin/sh
# Pre-commit: run cargo fmt --check and clippy before allowing the commit.
# Enable with: git config core.hooksPath githooks

set -e
cd "$(git rev-parse --show-toplevel)"

echo "Running cargo fmt --check..."
if ! cargo fmt --check; then
  echo "Failed: code is not formatted. Run 'cargo fmt' and try again."
  exit 1
fi

echo "Running cargo clippy..."
if ! cargo clippy --all-targets --features "onnx,report-cli,alignment-profiling" -- -D warnings; then
  echo "Failed: fix clippy warnings and try again."
  exit 1
fi

echo "Pre-commit checks passed."
exit 0
